## H5 Script Kiddie

Tehtävien lähde: https://terokarvinen.com/2021/penetration-testing-course-2022-spring/#comments kohta h5

# v) Lue ja tiivistä

O reilly

Ilmainen kokeilujaksoni oli loppunut, joten jouduin aloittamaan uuden.

- Termejä:
- Exploit - koodinpätkä joka sisältää haittakoodia ja käyttää haaovittuvuutta hyödykseen.
- Payload - Koodi, joka ajetaan kun kohteeseen on murtauduttu exploittia käyttämällä
- Meterpreter - Suosittu payload tyyppi. Sisältää paljon eri toiminnallisuuksia

- Metasploitin etuja
- Metasploit on avoimen lähdekoodin ohjelma
- Tukee suurien tietoverkkojen tunkeutumistestausta
- Payloadien helppo vaihtaminen lennosta
- Metasploit ei luultavasti kaada järjestelmää, johon se tunkeutuu.
- Sisäänrakennettu nmap tuki


Walkthrough murrosta
Video: https://www.youtube.com/watch?v=R7srpHUshuI

Alkutilanne: John on luonut kiosk virtuaalikoneen Windows 11. Eli kone joka avaa esimerkiksi jonkun nettisivun ja mitään muuta toiminnallisuutta ei ole.
F1 näppäimellä pääsee ns. help sivulle. Hänen kioskissaan microsoftin sivuille. Siellä hän navigoi privacy policy sivulle, ja painaa print nappia. Se avaa printtaus dialogin. Jos hän painaa print to pdf, aukeaa dialogi tallennuspaikan valinnalle. Windows 11 käyttiksessä pystyy oikealla klikillä valitsemaan open powershell in this location ja näin pääsee käsiksi powershelliin. Tämä ei kuitenkaan toiminut, koska powershelliin ei pystynyt kirjoittamaan.

Toinen tapa avata cmd rajoitetulla koneella on yrittää ladata jotain ja sitä kautta avata tallennusdialogi. John löytää bing wallpaper appin, jonka pystyy lataamaan. Kun latausdialogi aukeaa, pystyy painamaan get help nappia, joka avaa uuden selainikkunan. Tästä ikkunasta hän pystyy avaamaan normaalin file explorer ikkunan ja sen kautta cmd:n.

Ainoa tapaus missä tätä olisi voinut käyttää on peruskoulun koneet. Muistaakseni niissä osa toiminnallisuuksista oli estetty niin näillä tempuilla niitä olisi voinut avata. Ehkä toinen voisi olla kirjaston kone.


# a) Asenna metasploitable 3

Aloitin Googlaamalla asennusohjeet metasploitable kolmea varten. Seurasin tätä ohjetta: https://michaelnieto.com/metasploitable-3/

Ensiksi asensin Vagrantin: https://www.vagrantup.com/downloads

Sitten tallensin metasploitable 3 vagrantfilen tietokoneelleni.

Sitten avasin Powershell terminaalin ja ajoin komennon vagrant up. Noin 15 minuutin jälkeen metasploitable kone oli asennettu virtualboxiini. Käynnistin sen vielä uudestaan ja viilasin asetukset kuntoon. Kokeilin, että näkyykö kone lähiverkkoni ulkopuolelle

![image](https://user-images.githubusercontent.com/81921071/167265095-e06ec463-ecda-4115-af41-aa3a4df32945.png)

Ei näy, joten voin siirtyä seuraavaan tehtävään.

# b) murtaudu metasploit 3 käyttämällä Metasploittia

Varmistin vielä, että kali ei pääsen nettiin.

![image](https://user-images.githubusercontent.com/81921071/167270499-473c9545-1ec8-4ba4-9274-d3dc2552e3c2.png)

Koska tiedän jo valmiiksi metasploitable 3:n ip-osoitteen niin passiivista tiedustelua ei tarvitse tehdä. Aloitan aktiivisen tiedustelun nmapilla.

Komento: nmap -sS -sV -O -p- -oA ms3 192.168.56.104

Eli tehdään stealth scan, versio skannaus kaikille porteille ja OS skannaus, sekä tallennetaan output tiedostonimellä ms3.

![image](https://user-images.githubusercontent.com/81921071/167270493-e34c9e8d-bd04-4ed3-9a31-519b184d0f4a.png)

Aloin tutkimaan mahdollisia exploitteja. Ensiksi kokeilin muutamaa apache exploittia, mutta en saanut niitä toimimaan. Sitten aloin tutkimaan portissa 6697 ollutta UnrealIrcd palvelua. Googlasin mikä unrealircd on ja se on ilmeisesti IRC palvelin. 

Hain exploitteja komennolla search name:unreal

![image](https://user-images.githubusercontent.com/81921071/167271786-d3452c65-f2b5-4c73-89a2-b93d312d35d6.png)

Valitsin exploitin komennolla use 0 ja tarkistin asetukset komennolla show options

![image](https://user-images.githubusercontent.com/81921071/167271809-18618fd2-05b0-4ced-b0d6-902c3ed1d60f.png)

Valitsin RHOSTS:iksi metasploitable 3 koneen ip:n, ja RPORT:iksi 6697.

Kokeilin exploittia, mutta en ollut valinnut payloadia sille. Tarkistin, mitä payloadeja on saatavilla komennolla show payloads

![image](https://user-images.githubusercontent.com/81921071/167271852-83ad26d2-96aa-4960-9833-d24500145085.png)

Aloitin kokeilemaan payloadeja listasta. Kokeilin ensiksi bind_perls ja bind_ruby payloadeja. Kummallakaan ei ollut onnea.

![image](https://user-images.githubusercontent.com/81921071/167271871-6589de11-4f46-4ae5-86cf-27f9af004f22.png)

![image](https://user-images.githubusercontent.com/81921071/167271874-d447af94-40e6-4d3b-8aaa-9735a24cc96e.png)

Sitten kokeilin reverse payloadia. 

![image](https://user-images.githubusercontent.com/81921071/167271990-18bdd8d8-22f3-4f42-bd2d-d7f713edef5b.png)

Eli tässä luodaan pyyntö yhteydelle kalin portista 4444 kohteen porttiin 6697. Sitten exploit avaa takaoven shellille. Lopuksi metasploit avaa uuden shell session porttiin 59188 avattuun takaoveen.

Shell sessio aukesi ja metasploitableen murtauduttu.

![image](https://user-images.githubusercontent.com/81921071/167272068-c1106379-17b1-4d9d-8499-f4e4597eecd6.png)

Muodostettu yhteys näkyy myös metasploitablessa. Komento ss

![image](https://user-images.githubusercontent.com/81921071/167272353-0486e30e-b9fd-4165-aa4b-a26ee913a2a1.png)


# c) Rat. Demonstroi meterpreter:n käyttöä

Tehtävää varten lunttasin, miten saan nopeasti meterpreter session auki. Luntin lähde: https://stuffwithaurum.com/2020/04/17/metasploitable-3-linux-an-exploitation-guide/

Otin käyttöön multi/http/drupal_drupageddon exploitin. Syötin asetuksiin oikeat ip:t ja ajoin exploitin.

![image](https://user-images.githubusercontent.com/81921071/167273343-a63bdd46-7720-47e6-8a25-5572e03524b5.png)

Komennolla meterpreter help saadaan auki meterpreterin komentojen kuvaukset. Monia hyviä komentoja, joilla voidaan esimerkiksi selvittää lisää tietoa kohteesta. Esimerkiksi cat /etc/passwd saadaan käyttäjälista, upload komennolla voidaan tallentaa haitallisia tiedostoja kohteeseen, ps komennolla voidaan listata kohteessa pyörivät prosessit.

Download komennolla voidaan ladata tiedostoja kohteesta

![image](https://user-images.githubusercontent.com/81921071/167273958-32b6d82b-4fe4-40b4-8ebe-259f9a4edc26.png)ba

Shell komennolla pystyn avaamaan uuden shell session kohteeseen.

![image](https://user-images.githubusercontent.com/81921071/167273671-455384f7-d18f-4f7e-98e2-47f2df495912.png)

ps komennolla nään avaamani shell prosessin ja myös aiemmassa tehtävässä avaamani shellin

![image](https://user-images.githubusercontent.com/81921071/167273696-c7239b45-0071-4b56-a1a1-fa24a57365b7.png)

Meterpreterin hyötyjä:

Se on vaikeasti havaittava. Meterpreter pyörii kokonaan kohteen muistissa. Uusia prosesseja ei tarvitse luoda, koska meterpreter soluttautuu valmiiksi pyörivään prosessiin. Meterpreter käyttää myös salattuja yhteyksiä.

Se on tehokas, koska se käyttää kanavoitua kommunikaatiojärjestelmää. Meterpreteriin pystyy myös asentamaan laajennuksia ilman merkittävää vaivaa.

Lähde: https://www.offensive-security.com/metasploit-unleashed/about-meterpreter/

