## h4 Tiedustelua

Tehtävien lähde: https://terokarvinen.com/2021/penetration-testing-course-2022-spring/#comments kohta h4.

Kali linuxin kanssa oli hieman haasteita. Annoin lisää muistia ja painoin virtual boxista reset nappia. Kun sain kalin taas toimimaan, varmistin että se ei pääse yhdistämään oman virtualboxini ulkopuolelle komennolla ping 8.8.8.8. Network is unreacheable, joten voin aloittaa tehtävät. Kohteena on jälleen kerran metasploitable 2. Wireshark pyörii Kalissa. Wiresharkkiin tulee jostain syystä udp broadcast paketteja. Suodatin ne pois käyttämällä filtteriä tcp.

# z)

# a) nmap TCP connect scan -sT

Ajoin komennon sudo nmap -sT -p22 192.168.56.101 (viittaan tähän sanalla kohdeIp myöhemmissä kohdissa)

![image](https://user-images.githubusercontent.com/81921071/166102513-ed6c55b8-c7c0-437a-8482-0703b7226b1a.png)

Wiresharkin perusteella nmap muodostaa yhteyden kohdekoneen porttiin 22. Se lähettää normaalin tcp yhteyden avauksen eli SYN > SYN ACK > ACK lipuilla varustetut paketit. Yhteyden avaamisen jälkeen yhteys suljetaan.

Googlasin vielä tietoa, miten -sT valinta toimii. Nmap yrittää avata TCP yhteyden johonkin porttiin. Eli se avaa yhteyden ja kun kohde alkaa lähettää dataa, nmap sulkee yhteyden. TCP scannia käytetään yleensä, kun SYN scannia ei voida tehdä. Tämä scanni lähettää hieman enemmän paketteja kuin SYN scan, mutta niiden määrä ei ole merkittävä.

lähde: https://nmap.org/book/scan-methods-connect-scan.html

# b) nmap TCP SYN "used to be stealth" scan, -sS (tätä käytetään skannatessa useimmin)

Ajoin komennon sudo nmap -sS -p22 kohdeIp

![image](https://user-images.githubusercontent.com/81921071/166117750-3b00c2d6-c495-4b15-ac69-c80d0140bf0e.png)

Tässä scannauksessa yhteys suljetaan heti SYN ACK paketin jälkeen. Tämä on suosituin scannaustapa. SYN scannia sanotaan stealth scanniksi, koska TCP yhteys ei koskaan muodostu kokonaan. nmap tietää portin olevan auki SYN ACK lipuista, joilla kohde vastaa yhteyspyyntöön. SYN scan tarvitsee "Raw packet privileges" eli käytännössään root/admin oikeudet. Tämä perustuu trusted network & hardware oletukseen, joka on unix pohjaisissa järjestelmissä. Eli peruskäyttäjään ei luoteta.

Lähteet: https://nmap.org/book/synscan.html#scan-methods-fig-syn-scan-open

https://security.stackexchange.com/questions/244635/why-do-i-need-root-privileges-to-send-a-raw-packet-from-a-unix-machine

# c) nmap ping sweep -sn

Ajoin komennon nmap -sn 192.168.56.0/24

![image](https://user-images.githubusercontent.com/81921071/166118490-ce57ed8e-b801-4624-9aa5-cc7e9fe8fb25.png)

Tällä komennolla otetaan portti skannaus pois käytöstä ja tehdään pelkkä host discovery. Wiresharkissa näkyy, että nmap tekee ARP kyselyn jokaiselle määritellyn avaruuden ip-osoitteelle. Järjestelmän ylläpitäjälle hyvä työkalu.

lähde: https://nmap.org/book/host-discovery-controls.html#host-discovery-sn

# d) nmap don't ping -Pn



# e) nmap version detection -sV (esimerkki yhdestä palvelusta yhdessä portissa riittää)

Ajoin komennon nmap -sV -p22 kohdeIp

![image](https://user-images.githubusercontent.com/81921071/166118829-45d914df-d97a-44d4-84c0-74122171f09d.png)

![image](https://user-images.githubusercontent.com/81921071/166118977-a0bbc6e9-b21e-4aa0-a9cf-6bfd5a56bbe8.png)

Tässä skannauksessa selvitetään portin takana pyörivän palvelun tiedot ja versio. Eli nmap tunnistaa ensiksi, että portti 22 on auki. Sen jälkeen, nmap avaa uuden yhteyden jossa kohde lähettää tiedot, jotka löytyvät portin takaa. Kuvassa paketti 73. Tämän jälkeen yhteys suljetaan niin sanotusti oikealla tavalla. Eli FIN ACK liput lähetetään kohteelle ja yhteys sulkeutuu.
