## H3 Attaaack!

Tehtävien lähde: https://terokarvinen.com/2021/penetration-testing-course-2022-spring kohta h3.

# x) Lue/katso/kuuntele ja tiivistä. Tässä alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen ja tiivistelmä riittää). Tiivistä ranskalaisilla viivoilla.

Chapter21, cross site scripting

- Koodi ajetaan uhrin nettiselaimessa kun uhri yhdistää haavoittuvaan nettisivuun
- Reflected XSS - jos nettisivulla on suojaamaton muuttuja, hyökkääjä voi syöttää haluamansa javascriptin tähän muuttujaan ja sen jälkeen lähettää linkin tähän sivuun. Linkin voi lähettää vaikka emailin tai pikaviestimen kautta.
- Stored XSS - videossa javascript tallennetaan hyökkääjän lähettämään viestiin nettisivulla. Kun uhri menee sivulle, koodi ajetaan. Tässä ei tarvitse klikata hyökkääjän linkkiä.
- Seuraavassa esimerkissä käytetään BeEF frameworkia. Hyökkääjä syöttää viestiinsä javascriptin, joka yhdistää kaikkien sivulle menijöiden selaimet BeEF konsoliin. Konsolin kautta hyökkääjä voi ajaa lisää haittakoodia.
- Käyttäjä voi suojatua kytkemällä javascriptin pois päältä selaimestaan.

![image](https://user-images.githubusercontent.com/81921071/164891882-94032b9a-0052-4100-959d-3c18bd9833c5.png)
Firefoxissa asetus löytyy avaamalla selaimessa about:config, hakemalla javascript.enabled ja vaihtamalla arvoksi false.

Lähde: https://learning.oreilly.com/videos/the-complete-ethical/9781839210495/9781839210495-video21_1/ Chapter21 kaikki videot.

OWASP 2017

A2 Broken authentication

- Broken authentication tarkoittaa käytännössä huonoja tietoturva- ja turvallisuuskäytäntöjä tunnistautumiseen/kirjautumiseen liittyen.
- Haavoittuvuuksia on esimerkiksi MFA:n puuttuminen, heikkojen salasanojen käyttö, sessoiden aikakatkaisun puuttuminen ja brute force hyökkäysten sallimisen.
- Voidaan estää asettamalla käyttäjille pakollisia tietoturvavaatimuksia.
- Esimerkiksi vahvan salasanan käyttö, pakollinen MFA ja käyttäjän lukitseminen vaikka 5 epäonnistuneen kirjautumisyrityksen jälkeen.

A3 Sensitive data exposure

- Sensitive data exposure tarkoittaa esimerkiksi henkilökohtaisten tietojen, luottokorttien tietojen ja muun arkaluontoisen datan hallinnassa olevia haavoittuvuuksia.
- Haavoittuvuuksia ovat esimerkiksi Datan siirto clear text formaatissa (kryptauksen puuttuminen), heikkojen salausmenetelmien käyttö ja oletusarvoisten salausavainten käyttö.
- Hyökkääjä voi käyttää näitä haavoittuvuuksia esimerkiksi man in the middle hyökkäyksessä kun dataa siirretään tai jos hyökkääjä pääsee murtautumaan palvelimelle joka sisältää kryptaamatonta dataa.

A7 Cross site scripting

- Cross site scriptingiä on kolmea eri tyyppiä. Reflected XSS, joka hyödyntää suojaamatonta käyttäjän syötettä. Hyökkääjä voi syöttää haittakoodinsa muuttujaan sivulla ja jakaa linkin uhrilleen. Kun uhri klikkaa linkkiä, haittakoodi ajetaan uhrin selaimessa.
- Stored XSS hyökkäyksessä hyökkääjä voi tallentaa sivulle haittakoodinsa ja kun uhri avaa sivun, haittakoodi ajetaan uhrin selaimessa.
- DOM XSS. DOM tarkoittaa document object modelia, joka on HTML sivun rakenne. DOM XSS hyökkäyksessä hyökkääjä syöttää haittakoodin esimerkiksi valikkoon, ja lähettää haitallista koodia sisältävän linkin uhrille.
- Tyypillisessä XSS hyökkäyksessä hyökkääjä pyrkii kaappaamaan käyttäjän session, varastamaan käyttäjän kirjautumistiedot tai lataamaan muita haittaohjelmia kaapatun selaimen kautta.
- Nettisivu voidaan suojata cross site scriptingiltä validoimalla käyttäjän syöte. Esimerkiksi käyttämällä HTML enkoodausta. Ohjelmointi 2 kurssilla muistaakseni harjoiteltiin tätä.


Lähteet: https://raw.githubusercontent.com/OWASP/Top10/master/2017/OWASP%20Top%2010-2017%20(en).pdf

https://owasp.org/www-community/attacks/DOM_Based_XSS


Mitre 2021 ATT&CK enterprise matrix

Lähde: https://attack.mitre.org/matrices/enterprise/

- Tactic tarkoittaa syytä miksi käytetään jotain tekniikkaa tai alatekniikkaa tavoitteen saavuttamiseksi. Esimerkiksi Taktiikkaa Privilege escalation käytetään kun hyökkääjä yrittää saada pääsyn enemmän oikeuksia omaavaan käyttäjään esimerkiksi root tai admin käyttäjään.
- Technique tarkoittaa sitä kuinka tavoite saavutetaan. Esimerkiksi jos halutaan estää normaalien käyttäjien pääsy järjestelmään, hyökkääjä saattaa käyttää account access removal tekniikkaa häiritäkseen normaaleja käyttäjiä.
- procedure Imnplementaatio jota hyökkääjä käyttää tekniikoissaan. Esimerkiksi BlackEnergy haittaohjelma pystyy ohittamaan UAC asetukset käyttämällä backward-compatibility asetuksen haavoittuvuutta Windows järjestelmissä.

Tekniikat
- Reconnaissance: Hyökkääjä yrittää saada tietoa, jota hän voi käyttää myöhemmissä hyökkäyksissä. Tekniikkaesimerkki: Active Scanning. Hyökkääjä skannaa kohteen infrastruktuuria verkon yli ja yrittää löytää haavoittuvuuksia.
- Resource development: Hyökkääjä kehittää omaa infrastruktuuriaan mahdollistaakseen resurssien riittävyyden hyökkäysten toteuttamiseen. Tekniikkaesimerkki: Acquire Infrastructure - Botnet. Hyökkääjä hankkii käyttöönsä kaapattuja koneita, joita hän käyttää paljon instansseja vaativaan hyökkäykseen. Esimerkiksi DDoS hyökkäys.
- Initial access: Hyökkääjä yrittää murtautua verkkoon. Tekniikkaesimerkki: Phishing. Hyökkääjä yrittää saada yksityisen käyttäjän tai yrityksen työntekijän kirjautumistiedot johonkin palveluun. Phishingissä levitetään usein haittakoodia sisältävää linkkiä, vaikka emailin tai pikaviestimien kautta.
- Execution: Hyökkääjä yrittää ajaa haittakoodia. Tekniikkaesimerkki: User execution. Uhri saattaa klikata haittakoodia sisältävää linkkiä tai ladata haittakoodia sisältävän tiedoston, joka ajaa koodin uhrin järjestelmässä.
- Persistence: Hyökkääjä yrittää pitää saavuttamansa jalansijan. Tekniikkaesimerkki: Account manipulation - SSH authorized keys. Hyökkääjä muokkaa authorized_keys tiedostoa lisätäkseen oman SSH avaimensa tiedostoon. Jos käyttäjä ei huomaa muokkausta, hyökkääjällä on jättänyt takaoven auki onnistuneesti.
- Privilege escalation: Hyökkääjä yrittää saada pääsyn enemmän oikeuksia omaavaan käyttäjään esimerkiksi root tai admin käyttäjään. Tekniikkaesimerkki: Process injection. Käyttäjä ajaa haittakoodia toisen prosessin nimissä ja yrittää sen avulla saada pääsyn. Toisen prosessin nimissä toimiva haittakoodi saattaa harhauttaa suojausohjelmia.
- Defense evasion: Hyökkääjä yrittää pysytellä piilossa. Tekniikkaesimerkki: Impair defenses: Hyökkääjä estää esimerkiksi antiviruksen ja palomuurin toiminnan.
- Credential access: Hyökkääjä yrittää varastaa kirjautumistietoja(Käyttäjätunnus, salasana). Tekniikkaesimerkki: Brute force - password spraying: Hyökkääjä yrittää kirjautua tietyllä salasanalla  tai salasanalistalla käyttäjille. 
- Discovery: Hyökkääjä yrittää havannoida ympäristöä. Tekniikkaesimerkki: Cloud Infrastucture discovery: Hyökkääjä kartoittaa ympäristössä olevia IaaS resursseja. Esimerkiksi AWS, Azure tai Google cloud platform ympäristöissä.
- Lateral Movement: Hyökkääjä liikkuu ympäristössä. Tekniikkaesimerkki: Remote session hijacking: Hyökkääjä ottaa haltuunsa oikeiden käyttäjien avaamia etähallintasessioita, esimerkiksi SSH tai RDP.
- Collection: Hyökkääjä kerää tavoitteen saavuttamisen kannalta olennaista dataa. Tekniikkaesimerkki: Data from information repositories: Hyökkääjä kerää dataa yrityksen tietolähteistä. Esimerkiksi intranet ja Git repositoryt.
- Command and control: Hyökkääjä yrittää kommunikoida murrettujen järjestelmien kanssa hallitakseen niitä. Tekniikkaesimerkki: Application layer protocol: Hyökkääjä kommunikoi applikaatiotasolla yrittääkseen estää havaituksi joutumisen.
- Exfiltration: Hyökkääjä yrittää varastaa dataa. Tekniikkaesimerkki: Exfiltration over physical medium: Hyökkääjä varastaa dataa käyttämällä fyysistä laitetta sen siirtoon ulos kohdejärjestelmästä. Esimerkiksi haittaohjelman sisältävän usb tikun käyttö järjestelmässä.
- Impact: Hyökkääjä yrittää vaikuttaa järjestelmän toimintaan häiritsemällä, tuhoamalla dataa ja manipuloimalla järjestelmää. Tekniikkaesimerkki: Data destruction: Hyökkääjä poistaa dataa järjestelmistä aiheuttaakseen häiriötä. Esimerkiksi poistamalla konfiguraatiotiedostoja.


# z) Cross site story.

# a) Vuohen uudet seikkailut. Ratkaise WebGoatista tehtävät

**A2 Broken authentication** 2FA Password reset.

Tässä tehtävässä yritetään ohittaa käyttäjän turvakysymykset. (security questions).
Lähdin ratkaisemaan tehtävää avaamalla inspectorin selaimellani. Ohjeessa mainitaan, että security questionit voidaan poistaa HTTP POST requestin datasta. Avasin network välilehden inspectorista ja aloin tutkimaan.

![image](https://user-images.githubusercontent.com/81921071/164943356-ba467f3d-a950-4aa3-880c-5094b1f05c6a.png)
etsin kyseisen post requestin, joka lähetetään submit napista. Painoin oikealla klikillä ja valitsin edit and resend. Yritin jonkin aikaa erilaisia ratkaisuja kuten poistaa securityquestionit requestista ja muuttaa niiden sisältö "true" arvoiseksi booleaniksi. Nämä eivät onnistuneet, joten jouduin katsomaan mallia toisen henkilön tehtävästä. Katsoin mallia ja tutkin tämän malliratkaisun avulla. https://pvxs.medium.com/webgoat-authentication-bypass-2-4eeb8e8b502b

Ratkaisu oli poistaa muuttujien nimistä numerot. Java ohjelma, jota tämä harjoitus käyttää, tarkistaa onko muuttujan nimessä "securityQuestion" osa.

![image](https://user-images.githubusercontent.com/81921071/164943687-fdac4375-f97b-4925-b969-f61e3ba63ed9.png)

Vaihdoin nimet.

![image](https://user-images.githubusercontent.com/81921071/164943696-761439f5-9546-46ca-b010-877d6625e8f1.png)

Ohitettu. Valitettavasti jouduin lunttaamaan ratkaisun.

**A3 Sensitive data exposure** Insecure data

Tehtävänannossa mainitaan packet snifferin käyttö. Avasin WireSharkin ja valitsin adapteriksi loopback traffic. Kokeilin klikata log in nappia. Huomasin, että paketteja on valtava määrä joten asetin HTTP filtterin päälle. Nyt löysin POST requestin paketin, joka lähetettiin kun painoin nappia.

![image](https://user-images.githubusercontent.com/81921071/164944289-78a13b21-ef11-4634-80f7-959df59f5656.png)

Kävin POST requestin läpi, ja lopusta löytyi plain text formaatissa käyttäjätunnus ja salis.
![image](https://user-images.githubusercontent.com/81921071/164944316-0e1f2eef-6de6-408b-8679-4e1639fefaa4.png)

![image](https://user-images.githubusercontent.com/81921071/164944331-9a298a49-d78b-41cd-a0ae-ebc26244197d.png)

Läpi meni.

**A7 Cross Site Scripting (XSS)**

2 What is XSS

Tehtävässä testataan, toimiiko XSS webgoatin sivulla.

![image](https://user-images.githubusercontent.com/81921071/164944747-2a7adb70-9ac0-4392-9a4a-b8e5ee6f1c53.png)

Kokeilin tehtävässä annettuja alertteja ja XSS näyttäisi toimivan. Keksi on sama myös uudella tabilla.

![image](https://user-images.githubusercontent.com/81921071/164944792-0a578832-4175-4279-8095-5b06df276f88.png)


7 Reflected XSS

Tehtävässä tulee etsiä haavoittuva datakenttä. Aloitin kokeilemaan kenttiä ylhäältä alas alerttien avulla. Quantity kentät tarkistava, onko syöte numero. Credit card kenttä laittoi tehtävän läpi syötteellä 1<script>alert(XSS works on this data field)</script>. Ykkönen oli syötteessäni, koska kokeilin ensiksi noita Quantity kenttiä.

![image](https://user-images.githubusercontent.com/81921071/164945068-034031a7-1273-4cde-9baf-1b1438f11446.png)

**A8:2013 Request Forgeries:**

Cross site request forgeries

Basic Get CSFR Exercise

Harjoituksessa halutaan ajaa napin takaa löytyvä kysely jotain muuta kautta, kuin webgoatin sivulta. Aloitin tutkimalla sivun HTML:llää inspectorilla. Etsin sieltä napin takaa löytyvän HTML elementin ja kopioin sen luomaani HTML sivuun. Lisäsin vielä elementtiin loopback osoitteen, jotta firefox löytäisi oikean sivun.

![image](https://user-images.githubusercontent.com/81921071/164946072-50c63a63-4efd-4bf3-a4fe-f0683cedb41d.png)

Jostain syystä tämä avaa vain tyhjän sivun. Lähdin tutkimaan, tarkistin ensin webgoatin inspectorin network tabin. Sieltä ei löytynyt mitään. Sitten tarkistin vielä Submit query napin avaaman uuden välilehden network tabin. Sieltä löytyi POST request.

![image](https://user-images.githubusercontent.com/81921071/164946512-ba6fbad2-6dae-4cb6-b99e-398b864cbfc8.png)

Requestissa on tuo submit: 'Submit+Query' joka iski silmään. Luomassani HTML sivussa on vain "submit" input, vaikka verkkosivulla olevassa napissa lukee Submit Query. Suhteellisen pitkän pohdinnan jälkeen en keksinyt mistä tuon napin nimi tulee. Jouduin taas lunttaamaan jonkun muun tekemän mallivastauksen.

Mallivastaus: https://medium.com/@evidencemonday/webgoat-cross-site-request-forgery-solution-1c069985e80f

Lisäsin HTML sivulleni tuon Submit-Query inputin. Ei toiminut vieläkään. Liian pitkän pään seinään hakkaamisen jälkeen huomasin, että minulta puuttu http:// tuon urlin edestä. Toimii.

![image](https://user-images.githubusercontent.com/81921071/164946807-afd4b8e4-5cc3-482e-9fa6-bd9ac929770c.png)

![image](https://user-images.githubusercontent.com/81921071/164946816-e3ad9ae6-19ee-4c94-8f2b-1bf0a9e9bac3.png)

4 Post review on someone elses behalf

Tehtävä on samankaltainen tuon edellisen kanssa. Aloitan nyt luomalla uuden HTML sivun. Sen jälkeen kokeilen webgoatin kautta, mitä tapahtuu kun syötän arvostelun sen kautta.

![image](https://user-images.githubusercontent.com/81921071/164947117-682727e9-ed2f-43e4-ad3c-bb679d79cc85.png)

HTML

![image](https://user-images.githubusercontent.com/81921071/164947130-83daca2d-5b57-48e4-b319-e18dbf420585.png)

Syötin arvostelutekstiksi "iha ok" ja annoin 5 tähteä. Sivuni palautti tämän

![image](https://user-images.githubusercontent.com/81921071/164947206-cf216b88-bdfd-4ba7-9668-3b347e80c1b1.png)

Arvosteluni on siellä kahteen kertaan, koska syötin samalla tekstillä olevan arvostelun webgoatin sivun kautta.








